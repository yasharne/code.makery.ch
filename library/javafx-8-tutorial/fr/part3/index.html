<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tutoriel JavaFX 8 - partie 3 : interaction avec l'utilisateur | code.makery.ch</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--
    /**
     * @license
     * MyFonts Webfont Build ID 2872352, 2014-08-27T06:57:40-0400
     * 
     * The fonts listed in this notice are subject to the End User License
     * Agreement(s) entered into by the website owner. All other parties are 
     * explicitly restricted from using the Licensed Webfonts(s).
     * 
     * You may obtain a valid license at the URLs below.
     * 
     * Webfont: Museo Slab 700 by exljbris
     * URL: http://www.myfonts.com/fonts/exljbris/museo-slab/700/
     * Copyright: Copyright (c) 2009 by Jos Buivenga. All rights reserved.
     * Licensed pageviews: 500,000
     * 
     * License: http://www.myfonts.com/viewlicense?type=web&buildid=2872352
     * 
     * © 2014 MyFonts Inc
    */
    -->
    <link href="/theme/css/style.min.css" rel="stylesheet" type="text/css" media="all" />
    <link rel="canonical" href="http://code.makery.ch/library/javafx-8-tutorial/fr/part3/" />
  
    <!-- Alternate Languages -->
    <link rel="alternate" hreflang="en" href="http://code.makery.ch/library/javafx-8-tutorial/part3/" />
    <link rel="alternate" hreflang="es" href="http://code.makery.ch/library/javafx-8-tutorial/es/part3/" />
    <link rel="alternate" hreflang="fr" href="http://code.makery.ch/library/javafx-8-tutorial/fr/part3/" />
    <link rel="alternate" hreflang="id" href="http://code.makery.ch/library/javafx-8-tutorial/id/part3/" />
    <link rel="alternate" hreflang="it" href="http://code.makery.ch/library/javafx-8-tutorial/it/part3/" />
    <link rel="alternate" hreflang="pt" href="http://code.makery.ch/library/javafx-8-tutorial/pt/part3/" />
    <link rel="alternate" hreflang="ru" href="http://code.makery.ch/library/javafx-8-tutorial/ru/part3/" />
    <link rel="alternate" hreflang="tr" href="http://code.makery.ch/library/javafx-8-tutorial/tr/part3/" />
    <link rel="alternate" hreflang="uk" href="http://code.makery.ch/library/javafx-8-tutorial/uk/part3/" />
    <link rel="alternate" hreflang="zh-cn" href="http://code.makery.ch/library/javafx-8-tutorial/zh-cn/part3/" />

    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" href="/rss" title="code.makery.ch - RSS Feed">

    <meta name="description" content="Réagir aux changements de sélection dans le JavaFX TableView. Ajouter, modifier et supprimer des éléments de la table et valider l'entrée de l'utilisateur.">

    <!-- Twitter Card data -->
    <meta name="twitter:card" value="summary">

    <!-- Open Graph data -->
    <meta property="og:title" content="Tutoriel JavaFX 8 - partie 3 : interaction avec l'utilisateur | code.makery.ch" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Réagir aux changements de sélection dans le JavaFX TableView. Ajouter, modifier et supprimer des éléments de la table et valider l'entrée de l'utilisateur." />
    <meta property="og:url" content="http://code.makery.ch/library/javafx-8-tutorial/fr/part3/" />
    <meta property="og:image" content="http://code.makery.ch/assets/library/javafx-8-tutorial/part3/addressapp-part3.png" />
    
    <link rel="author" href="https://plus.google.com/+MarcoJakob7"/>
    
    <link href="/theme/css/prettify.min.css" rel="stylesheet" type="text/css" media="all" />

    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-34917397-3', 'makery.ch');
  ga('send', 'pageview');
</script>
  </head>
  <body onload="prettyPrint()">
    <header class="site-header container">
  <h1 class="site-title">
    <a href="/"><span class="main-text">code</span>.makery</a>
  </h1>
  <div class="site-intro">
    <p>Learning how to code.</p>
  </div>
  
  <div class="ribbon">
    <a href="https://tinyletter.com/codemakery" title="Get Updates">Subscribe to <i class="fa fa-envelope-o"></i> Updates </a>
  </div>
</header>
    
    <div class="container article-container">
      
<nav class="site-navigation">
  <ul>
    <li><a class="black-link" href="/">Home</a></li>
    <li><a class="main-link" href="/library/">Library</a></li>
    <li><a class="black-link" href="/paths/">Paths</a></li>
    <li><a class="black-link" href="/blog/">Blog</a></li>
    <li><a class="black-link" href="/about/">About</a></li>
  </ul>
</nav>
      
      <div class="row">
        <div class="col-md-12">
          <div class="github-edit">
            <a href="https://github.com/marcojakob/code.makery.ch/edit/master/collections/library/javafx-8-tutorial-fr-part3.md">Edit on GitHub</a>
          </div>
        </div>
      </div>
      
      <article class="row">
        <aside class="col-md-3">
          <div class="visible-md-block visible-lg-block">
          <div class="panel panel-default sidebar">
  <div class="panel-heading">
    <h4 class="panel-title">Les articles dans ce tutoriel</h4>  
  </div>

  <div class="list-group">
      <a href="/library/javafx-8-tutorial/fr/" class="list-group-item">
        Introduction</a>
      <a href="/library/javafx-8-tutorial/fr/part1/" class="list-group-item">
        Partie 1 : le Scene Builder</a>
      <a href="/library/javafx-8-tutorial/fr/part2/" class="list-group-item">
        Partie 2 : modèle et TableView</a>
      <a href="/library/javafx-8-tutorial/fr/part3/" class="list-group-item active">
        Partie 3 : interaction avec l'utilisateur</a>
      <a href="/library/javafx-8-tutorial/fr/part4/" class="list-group-item">
        Partie 4 : style CSS</a>
      <a href="/library/javafx-8-tutorial/fr/part5/" class="list-group-item">
        Partie 5 : stockage de données en XML</a>
      <a href="/library/javafx-8-tutorial/fr/part6/" class="list-group-item">
        Partie 6 : statistiques graphiques</a>
      <a href="/library/javafx-8-tutorial/fr/part7/" class="list-group-item">
        Partie 7 : déploiement</a>
  </div>
</div>
<div class="panel panel-default sidebar">
  <div class="panel-heading">
    <h4 class="panel-title">Téléchargez les sources</h4>  
  </div>

  <div class="list-group">
      <a href="https://github.com/marcojakob/tutorial-javafx-8/releases/download/v1.1/addressapp-jfx8u40-part-3.zip" class="list-group-item">
<i class="fa fa-fw fa-download"></i>        Projet Eclipse relatif à la partie 3 <em>(JDK 8u40 requis au minimum)</em></a>
  </div>
</div>

          <div class="panel panel-default sidebar">
  <div class="panel-heading">
    <h4 class="panel-title">Langues</h4>  
  </div>
  <div class="list-group">
      <a href="/library/javafx-8-tutorial/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> English
      </a>
      <a href="/library/javafx-8-tutorial/es/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Español
      </a>
      <a href="/library/javafx-8-tutorial/fr/part3/" class="list-group-item active">
        <i class="fa fa-fw fa-globe"></i> Français
      </a>
      <a href="/library/javafx-8-tutorial/id/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Bahasa Indonesia
      </a>
      <a href="/library/javafx-8-tutorial/it/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Italiano
      </a>
      <a href="/library/javafx-8-tutorial/pt/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Português
      </a>
      <a href="/library/javafx-8-tutorial/ru/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Русский
      </a>
      <a href="/library/javafx-8-tutorial/tr/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Türkçe
      </a>
      <a href="/library/javafx-8-tutorial/uk/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> Українська
      </a>
      <a href="/library/javafx-8-tutorial/zh-cn/part3/" class="list-group-item">
        <i class="fa fa-fw fa-globe"></i> 中文（简体）
      </a>
  </div>
</div>

          </div>
        </aside>
        <div class="col-md-9">
          <header class="article-header">
            <h1 class="article-title">Tutoriel JavaFX 8 - partie 3 : interaction avec l'utilisateur</h1>
            <div class="article-date">
  Apr 24, 2014
  • Updated Apr 15, 2015

</div>
          </header>
          
          <aside class="visible-xs-block visible-sm-block">
            <div class="btn-group sidebar-dropdown">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Les articles dans ce tutoriel <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
      <li class=""><a href="/library/javafx-8-tutorial/fr/">
        Introduction</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part1/">
        Partie 1 : le Scene Builder</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part2/">
        Partie 2 : modèle et TableView</a></li>
      <li class=" active"><a href="/library/javafx-8-tutorial/fr/part3/">
        Partie 3 : interaction avec l'utilisateur</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part4/">
        Partie 4 : style CSS</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part5/">
        Partie 5 : stockage de données en XML</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part6/">
        Partie 6 : statistiques graphiques</a></li>
      <li class=""><a href="/library/javafx-8-tutorial/fr/part7/">
        Partie 7 : déploiement</a></li>
  </ul>
</div>
<div class="btn-group sidebar-dropdown">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Téléchargez les sources <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
      <li class=""><a href="https://github.com/marcojakob/tutorial-javafx-8/releases/download/v1.1/addressapp-jfx8u40-part-3.zip">
<i class="fa fa-fw fa-download"></i>        Projet Eclipse relatif à la partie 3 <em>(JDK 8u40 requis au minimum)</em></a></li>
  </ul>
</div>

            <div class="btn-group sidebar-dropdown">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Langues <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
      <li class="">
        <a href="/library/javafx-8-tutorial/part3/"><i class="fa fa-fw fa-globe"></i> English</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/es/part3/"><i class="fa fa-fw fa-globe"></i> Español</a>
    </li>
      <li class=" active">
        <a href="/library/javafx-8-tutorial/fr/part3/"><i class="fa fa-fw fa-globe"></i> Français</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/id/part3/"><i class="fa fa-fw fa-globe"></i> Bahasa Indonesia</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/it/part3/"><i class="fa fa-fw fa-globe"></i> Italiano</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/pt/part3/"><i class="fa fa-fw fa-globe"></i> Português</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/ru/part3/"><i class="fa fa-fw fa-globe"></i> Русский</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/tr/part3/"><i class="fa fa-fw fa-globe"></i> Türkçe</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/uk/part3/"><i class="fa fa-fw fa-globe"></i> Українська</a>
    </li>
      <li class="">
        <a href="/library/javafx-8-tutorial/zh-cn/part3/"><i class="fa fa-fw fa-globe"></i> 中文（简体）</a>
    </li>
  </ul>
</div>

          </aside>
          
          <div class="article-content">
            <p><img src="/assets/library/javafx-8-tutorial/part3/addressapp-part3.png" alt="Screenshot AddressApp Part 3"></p>
<h2 id="topics-in-part-3">Topics in Part 3</h2>
<ul>
<li><strong>Réagir aux changements de sélections</strong> dans le tableau.</li>
<li>Ajouter les fonctionnalités aux boutons <strong>add</strong>, <strong>edit</strong> et <strong>remove</strong>.</li>
<li>Créer une <strong>fenêtre de dialogue</strong> personnalisée pour éditer une personne.</li>
<li><strong>Valider les entrées de l'utilisateur</strong>.</li>
</ul>
<hr>
<h2 id="r-agir-aux-s-lections-dans-le-tableau">Réagir aux sélections dans le tableau</h2>
<p>Évidemment, nous n'avons pas utilisé la droite de notre application, pour l'instant. L'idée est de montrer les détails d'une personne sur le côté juste quand l'utilisateur sélectionne une personne dans la liste.</p>
<p>Premièrement, ajoutons une nouvelle méthode dans <code>PersonOverviewController</code> qui nous aidera à remplir les labels avec les données d'une <code>Person</code></p>
<p>Créons une méthode appelée <code>showPersonDetails(Person person)</code>. Parcourons tous les labels et définissons le texte en utilisant <code>setText(...)</code> avec les détails de la personne. Si <code>null</code> est passé en paramètre, tous les labels devront être réinitialisés.</p>
<h5 id="personoverviewcontroller-java">PersonOverviewController.java</h5>
<pre class="prettyprint lang-java">
/**
 * Fills all text fields to show details about the person.
 * If the specified person is null, all text fields are cleared.
 *
 * @param person the person or null
 */
private void showPersonDetails(Person person) {
    if (person != null) {
        // Fill the labels with info from the person object.
        firstNameLabel.setText(person.getFirstName());
        lastNameLabel.setText(person.getLastName());
        streetLabel.setText(person.getStreet());
        postalCodeLabel.setText(Integer.toString(person.getPostalCode()));
        cityLabel.setText(person.getCity());

        // TODO: We need a way to convert the birthday into a String!
        // birthdayLabel.setText(...);
    } else {
        // Person is null, remove all the text.
        firstNameLabel.setText("");
        lastNameLabel.setText("");
        streetLabel.setText("");
        postalCodeLabel.setText("");
        cityLabel.setText("");
        birthdayLabel.setText("");
    }
}
</pre>

<h3 id="convertir-birthday-date-en-un-string">Convertir Birthday Date en un String</h3>
<p>Vous aurez remarqué que nous pouvons mettre <code>birthday</code> dans le <code>Label</code> car il est du type <code>LocalDate</code> et non un <code>String</code>. Nous devons d'abord formater la date.</p>
<p>Nous allons utiliser la conversion à partir de <code>LocalDate</code> et <code>String</code> et vice-versa en plusieurs endroits du code. C'est un bon exercice de créer une classe auxiliaire avec une méthode <code>static</code> pour cela. Nous allons l'appeler <code>DateUtil</code> et la placer dans un package séparé appelé <code>ch.makery.address.util</code>:</p>
<h5 id="dateutil-java">DateUtil.java</h5>
<pre class="prettyprint lang-java">
package ch.makery.address.util;

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;

/**
 * Helper functions for handling dates.
 *
 * @author Marco Jakob
 */
public class DateUtil {

    /** The date pattern that is used for conversion. Change as you wish. */
    private static final String DATE_PATTERN = "dd.MM.yyyy";

    /** The date formatter. */
    private static final DateTimeFormatter DATE_FORMATTER =
            DateTimeFormatter.ofPattern(DATE_PATTERN);

    /**
     * Returns the given date as a well formatted String. The above defined
     * {@link DateUtil#DATE_PATTERN} is used.
     *
     * @param date the date to be returned as a string
     * @return formatted string
     */
    public static String format(LocalDate date) {
        if (date == null) {
            return null;
        }
        return DATE_FORMATTER.format(date);
    }

    /**
     * Converts a String in the format of the defined {@link DateUtil#DATE_PATTERN}
     * to a {@link LocalDate} object.
     *
     * Returns null if the String could not be converted.
     *
     * @param dateString the date as String
     * @return the date object or null if it could not be converted
     */
    public static LocalDate parse(String dateString) {
        try {
            return DATE_FORMATTER.parse(dateString, LocalDate::from);
        } catch (DateTimeParseException e) {
            return null;
        }
    }

    /**
     * Checks the String whether it is a valid date.
     *
     * @param dateString
     * @return true if the String is a valid date
     */
    public static boolean validDate(String dateString) {
        // Try to parse the String.
        return DateUtil.parse(dateString) != null;
    }
}
</pre>

<div class="alert alert-info">
<strong>Astuce:</strong> Vous pouvez changer le format de la date en changeant le
<code>DATE_PATTERN</code>. Pour tous les formats possibles voir <a class="alert-link" href="http://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html">DateTimeFormatter</a>.
</div>


<h4 id="utiliser-le-dateutil">Utiliser le DateUtil</h4>
<p>Maintenant nous devons utiliser notre tout nouveau <code>DateUtil</code> dans la méthode <code>showPersonDetails</code> de <code>PersonOverviewController</code>. Remplaçons le <em>TODO</em> que nous avions ajouté par la ligne suivante:</p>
<pre class="prettyprint lang-java">
birthdayLabel.setText(DateUtil.format(person.getBirthday()));
</pre>


<h3 id="ecouter-les-changements-dans-la-s-lection-du-tableau">Ecouter les changements dans la sélection du tableau</h3>
<p>Pour être informé quand l'utilisateur sélectionne une personne dans la tableau correspondant, nous avons besoin <em>d'écouter les changements</em>.</p>
<p>Il y a une interface dans JavaFX appelée <a href="http://docs.oracle.com/javase/8/javafx/api/"><code>ChangeListener</code></a> comprenant une méthode nommé <code>changed(...)</code>. Cette méthode possède trois paramètres: <code>observable</code>, <code>oldValue</code>, and <code>newValue</code>.</p>
<p>Nous allons créer un <code>ChangeListener</code> via les <em>expressions lambda</em> introduite dans Java 8. Ajoutons quelques lignes à la méthode <code>initialize()</code>dans la class <code>PersonOverviewController</code>. Cela ressemble maintenant à ceci:</p>
<h5 id="personoverviewcontroller-java">PersonOverviewController.java</h5>
<pre class="prettyprint lang-java">
@FXML
private void initialize() {
    // Initialize the person table with the two columns.
    firstNameColumn.setCellValueFactory(
            cellData -> cellData.getValue().firstNameProperty());
    lastNameColumn.setCellValueFactory(
            cellData -> cellData.getValue().lastNameProperty());

    // Clear person details.
    showPersonDetails(null);

    // Listen for selection changes and show the person details when changed.
    personTable.getSelectionModel().selectedItemProperty().addListener(
            (observable, oldValue, newValue) -> showPersonDetails(newValue));
}
</pre>

<p>Avec <code>showPersonDetails(null);</code> nous réinitialisons les détails de la personne. </p>
<p>Avec <code>personTable.getSelectionModel...</code> nous obtenons la <em>selectedItemProperty</em> de la table de personnes et lui ajoutons un listener. Chaque fois que l'utilisateur sélectionne une personne dans la table, notre <em>expression lambda</em> est exécutée.  Nous prenons la personne nouvellement sélectionnée pour la transmettre à la méthode <code>showPersonDetails(...)</code>.</p>
<p>Essayez de <strong>lancer l'application</strong> à ce stade. Verifiez que lorsque vous sélectionnez une personne dans la table, les détails de celle-ci soient affichés à droite.</p>
<p>Si quelque chose ne fonctionne pas, vous pouvez comparer votre classe <code>PersonOverviewController</code> avec <a href="/assets/library/javafx-8-tutorial/part3/PersonOverviewController.java">PersonOverviewController.java</a>.</p>
<hr>
<h2 id="le-boutton-delete">Le boutton Delete</h2>
<p>Notre interface utilisateur contient déjà un bouton de suppression mais sans aucune fonctionnalité. Nous pouvons choisir l'action d'un bouton à l'intérieur du <em>Scene Builder </em>. 
Toute méthode dans notre contrôleur qui est annotée avec <code>@ FXML</code> (ou est publique) est accessible par le <em>Scene Builder</em>. Ainsi, nous allons ajouter d'abord une méthode de suppression à la fin de notre classe <code>PersonOverviewController</code>:</p>
<h5 id="personoverviewcontroller-java">PersonOverviewController.java</h5>
<pre class="prettyprint lang-java">
/**
 * Called when the user clicks on the delete button.
 */
@FXML
private void handleDeletePerson() {
    int selectedIndex = personTable.getSelectionModel().getSelectedIndex();
    personTable.getItems().remove(selectedIndex);
}
</pre>

<p>Maintenant, ouvrez le fichier <code>PersonOverview.fxml</code> dans <em>SceneBuilder</em>. Sélectionnez le bouton <em>Delete</em>, ouvrez le groupe <em>Code</em> et choisissez <code>handleDeletePerson</code> dans la liste déroulante de <strong> On Action </strong>.</p>
<p><img src="/assets/library/javafx-8-tutorial/part3/handle-delete.png" alt="On Action"></p>
<div class="alert alert-info">
<strong> N'oubliez pas: </strong> Après avoir modifié un fichier FXML à partir de Scene Builder vous pourriez avoir besoin de rafraîchir le projet dans Eclipse pour que les modifications soient appliquées.
</div>


<h3 id="gestion-des-erreurs">Gestion des erreurs</h3>
<p>Si vous lancez l'application à ce stade, vous devriez être capable de supprimer la personne sélectionnée de la table. Cependant, qu'arriverait-il si vous <strong>cliquiez sur le bouton supprimer en ayant sélectionné aucune personne</strong> dans la table?</p>
<p>Il y aura un <code>ArrayIndexOutOfBoundsException</code> parce qu'il ne pouvait pas enlever un objet  personne à l'index <code>-1</code>. L'index <code>-1</code> a été retourné par <code>getSelectedIndex()</code> - ce qui signifie qu'il n'y avait pas de sélection.</p>
<p>Ignorer de telles erreurs n'est pas très recommendable. Nous devrions laisser l'utilisateur savoir qu'il ou elle doit sélectionner une personne avant d'appuyer sur le bouton supprimer. (Il serait encore mieux de désactiver le bouton de sorte que l'utilisateur n'ait même pas la chance de faire quelque chose de mal.)</p>
<p>Après quelques modifications apportées à la méthode <code>handleDeletePerson()</code>, nous pouvons afficher une simple boîte de dialogue, chaque fois que l'utilisateur appuira sur le button supprimer sans aucune personne sélectionnée au préalable dans la table:</p>
<h5 id="personoverviewcontroller-java">PersonOverviewController.java</h5>
<pre class="prettyprint lang-java">
/**
 * Called when the user clicks on the delete button.
 */
@FXML
private void handleDeletePerson() {
    int selectedIndex = personTable.getSelectionModel().getSelectedIndex();
    if (selectedIndex >= 0) {
        personTable.getItems().remove(selectedIndex);
    } else {
        // Nothing selected.
        Alert alert = new Alert(AlertType.WARNING);
        alert.initOwner(mainApp.getPrimaryStage());
        alert.setTitle("No Selection");
        alert.setHeaderText("No Person Selected");
        alert.setContentText("Please select a person in the table.");

        alert.showAndWait();
    }
}
</pre>

<div class="alert alert-info">
Pour plus d'exemples sur comment utiliser les boîtes de dialogue, lisez mon article sur <a class="alert-link" href="/blog/javafx-dialogs-official/">JavaFX Dialogs</a>.
</div>


<hr>
<h2 id="les-dialogues-nouveau-et-editer">Les dialogues Nouveau et Editer</h2>
<p>Les actions Nouveau et Editer demandent un peu plus de travail. Nous allons avoir besoin d'une boîte de dialogue modifiée (ce qui veut dire un nouveau <code>Stage</code>) avec un formulaire pour demander à l'utilisateur des détails à propos d'une personne.</p>
<h3 id="conception-de-la-bo-te-de-dialgoue">Conception de la boîte de dialgoue</h3>
<ol>
<li><p>Créer un nouveau fichier fxml appelé <code>PersonEditDialog.fxml</code> à l'intérieur du package <em>view</em>. 
<img src="/assets/library/javafx-8-tutorial/part3/person-edit-dialog1.png" alt="Create Edit Dialog"></p>
</li>
<li><p>Utilisez un <code>GridPane</code>, des <code>Label</code>, des <code>TextField</code> et des <code>Button</code> pour créer une boîte de dialgoue comme suit:
<img src="/assets/library/javafx-8-tutorial/part3/person-edit-dialog2.png" alt="Edit Dialog"></p>
</li>
</ol>
<h3 id="cr-er-le-contr-leur">Créer le Contrôleur</h3>
<p>Créez le contrôleur de la boîte de dialogue comme <code>PersonEditDialogController.java</code>:</p>
<h5 id="personeditdialogcontroller-java">PersonEditDialogController.java</h5>
<pre class="prettyprint lang-java pre-scrollable">
package ch.makery.address.view;

import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.TextField;
import javafx.stage.Stage;
import ch.makery.address.model.Person;
import ch.makery.address.util.DateUtil;

/**
 * Dialog to edit details of a person.
 *
 * @author Marco Jakob
 */
public class PersonEditDialogController {

    @FXML
    private TextField firstNameField;
    @FXML
    private TextField lastNameField;
    @FXML
    private TextField streetField;
    @FXML
    private TextField postalCodeField;
    @FXML
    private TextField cityField;
    @FXML
    private TextField birthdayField;


    private Stage dialogStage;
    private Person person;
    private boolean okClicked = false;

    /**
     * Initializes the controller class. This method is automatically called
     * after the fxml file has been loaded.
     */
    @FXML
    private void initialize() {
    }

    /**
     * Sets the stage of this dialog.
     *
     * @param dialogStage
     */
    public void setDialogStage(Stage dialogStage) {
        this.dialogStage = dialogStage;
    }

    /**
     * Sets the person to be edited in the dialog.
     *
     * @param person
     */
    public void setPerson(Person person) {
        this.person = person;

        firstNameField.setText(person.getFirstName());
        lastNameField.setText(person.getLastName());
        streetField.setText(person.getStreet());
        postalCodeField.setText(Integer.toString(person.getPostalCode()));
        cityField.setText(person.getCity());
        birthdayField.setText(DateUtil.format(person.getBirthday()));
        birthdayField.setPromptText("dd.mm.yyyy");
    }

    /**
     * Returns true if the user clicked OK, false otherwise.
     *
     * @return
     */
    public boolean isOkClicked() {
        return okClicked;
    }

    /**
     * Called when the user clicks ok.
     */
    @FXML
    private void handleOk() {
        if (isInputValid()) {
            person.setFirstName(firstNameField.getText());
            person.setLastName(lastNameField.getText());
            person.setStreet(streetField.getText());
            person.setPostalCode(Integer.parseInt(postalCodeField.getText()));
            person.setCity(cityField.getText());
            person.setBirthday(DateUtil.parse(birthdayField.getText()));

            okClicked = true;
            dialogStage.close();
        }
    }

    /**
     * Called when the user clicks cancel.
     */
    @FXML
    private void handleCancel() {
        dialogStage.close();
    }

    /**
     * Validates the user input in the text fields.
     *
     * @return true if the input is valid
     */
    private boolean isInputValid() {
        String errorMessage = "";

        if (firstNameField.getText() == null || firstNameField.getText().length() == 0) {
            errorMessage += "No valid first name!\n";
        }
        if (lastNameField.getText() == null || lastNameField.getText().length() == 0) {
            errorMessage += "No valid last name!\n";
        }
        if (streetField.getText() == null || streetField.getText().length() == 0) {
            errorMessage += "No valid street!\n";
        }

        if (postalCodeField.getText() == null || postalCodeField.getText().length() == 0) {
            errorMessage += "No valid postal code!\n";
        } else {
            // try to parse the postal code into an int.
            try {
                Integer.parseInt(postalCodeField.getText());
            } catch (NumberFormatException e) {
                errorMessage += "No valid postal code (must be an integer)!\n";
            }
        }

        if (cityField.getText() == null || cityField.getText().length() == 0) {
            errorMessage += "No valid city!\n";
        }

        if (birthdayField.getText() == null || birthdayField.getText().length() == 0) {
            errorMessage += "No valid birthday!\n";
        } else {
            if (!DateUtil.validDate(birthdayField.getText())) {
                errorMessage += "No valid birthday. Use the format dd.mm.yyyy!\n";
            }
        }

        if (errorMessage.length() == 0) {
            return true;
        } else {
            // Show the error message.
            Alert alert = new Alert(AlertType.ERROR);
            alert.initOwner(dialogStage);
            alert.setTitle("Invalid Fields");
            alert.setHeaderText("Please correct invalid fields");
            alert.setContentText(errorMessage);

            alert.showAndWait();

            return false;
        }
    }
}
</pre>

<p>De petites choses sont à noter concernant ce contrôleur:</p>
<ul>
<li>La méthode <code>setPerson(...)</code> peut être appelée par une autre classe pour définir la personne qui doit être éditée.</li>
<li>Quand l'utilisateur clique sur le bouton OK, la méthode <code>handleOk()</code> est appelée. Tout d'abord, une certaine validation est effectuée en appelant la méthode <code>isInputValid ()</code>. Si et seulement si la validation est réussie, l'objet personne est rempli avec les données entrées par l'utilisateur. Ces changements vont directement être appliqués à l'objet personne passé en paramètre de <code>setPerson(...)</code>!</li>
<li>Le booléen <code>okClicked</code> est utilisé de sorte que l'appelant peut déterminé si l'utilisateur a cliqué sur le bouton OK ou Annuler.</li>
</ul>
<h3 id="lier-la-vue-et-le-contr-leur">Lier la vue et le contrôleur</h3>
<p>Avec la vue (FXML) et le contrôleur enfin créés, nous avons besoin de les lier.</p>
<ol>
<li>Ouvrez le fichier <code>PersonEditDialog.fxml</code>.</li>
<li>Dans le groupe <em>Controller</em> à gauche sélectionnez <code>PersonEditDialogController</code> comme classe contrôleur.</li>
<li>Définissez les <strong>fx:id</strong> de tous les <code>TextField</code> avec les champs du contrôleur correspondant.</li>
<li>Définissez les <strong>onAction</strong> des deux buttons aux méthodes handler correspondantes.</li>
</ol>
<h3 id="ouvrir-la-bo-te-de-dialgoue">Ouvrir la boîte de dialgoue</h3>
<p>Ajoutez une méthode pour charger et afficher la boîte de dialogue d'édition de personnes dans notre <code>MainApp</code>:</p>
<h5 id="mainapp-java">MainApp.java</h5>
<pre class="prettyprint lang-java">
/**
 * Opens a dialog to edit details for the specified person. If the user
 * clicks OK, the changes are saved into the provided person object and true
 * is returned.
 *
 * @param person the person object to be edited
 * @return true if the user clicked OK, false otherwise.
 */
public boolean showPersonEditDialog(Person person) {
    try {
        // Load the fxml file and create a new stage for the popup dialog.
        FXMLLoader loader = new FXMLLoader();
        loader.setLocation(MainApp.class.getResource("view/PersonEditDialog.fxml"));
        AnchorPane page = (AnchorPane) loader.load();

        // Create the dialog Stage.
        Stage dialogStage = new Stage();
        dialogStage.setTitle("Edit Person");
        dialogStage.initModality(Modality.WINDOW_MODAL);
        dialogStage.initOwner(primaryStage);
        Scene scene = new Scene(page);
        dialogStage.setScene(scene);

        // Set the person into the controller.
        PersonEditDialogController controller = loader.getController();
        controller.setDialogStage(dialogStage);
        controller.setPerson(person);

        // Show the dialog and wait until the user closes it
        dialogStage.showAndWait();

        return controller.isOkClicked();
    } catch (IOException e) {
        e.printStackTrace();
        return false;
    }
}
</pre>

<p>Ajoutez les méthodes suivantes à la classe <code>PersonOverviewController</code>. Ces méthodes vont appeller <code>showPersonEditDialog(...)</code>  de <code>MainApp</code> lorsque l'utilisateur clique sur les bouttons <em>Nouveau</em> ou <em>Editer</em>.</p>
<h5 id="personoverviewcontroller-java">PersonOverviewController.java</h5>
<pre class="prettyprint lang-java">
/**
 * Called when the user clicks the new button. Opens a dialog to edit
 * details for a new person.
 */
@FXML
private void handleNewPerson() {
    Person tempPerson = new Person();
    boolean okClicked = mainApp.showPersonEditDialog(tempPerson);
    if (okClicked) {
        mainApp.getPersonData().add(tempPerson);
    }
}

/**
 * Called when the user clicks the edit button. Opens a dialog to edit
 * details for the selected person.
 */
@FXML
private void handleEditPerson() {
    Person selectedPerson = personTable.getSelectionModel().getSelectedItem();
    if (selectedPerson != null) {
        boolean okClicked = mainApp.showPersonEditDialog(selectedPerson);
        if (okClicked) {
            showPersonDetails(selectedPerson);
        }

    } else {
        // Nothing selected.
        Alert alert = new Alert(AlertType.WARNING);
        alert.initOwner(mainApp.getPrimaryStage());
        alert.setTitle("No Selection");
        alert.setHeaderText("No Person Selected");
        alert.setContentText("Please select a person in the table.");

        alert.showAndWait();
    }
}
</pre>

<p>Ouvrez le fichier <code>PersonOverview.fxml</code> dans Scene Builder. Choisissez les méthodes correspondantes dans <em>On Action</em> pour les boutons Nouveau et Editer.</p>
<hr>
<h2 id="termin-">Terminé !</h2>
<p>Vous devriez avoir une <em>application d'adresses</em> fonctionnelle dorénavant. L'application est capable d'ajouter, d'éditer et de supprimer des personnes. Il y a même quelques validations pour les champs de text pour éviter les mauvaises manipulations des utilisateurs.</p>
<p>J'espère que les conceptes et la structure de cette application vous permettra de bien démarrer la rédaction de votre propre application! Amusez-vous bien.</p>
<h3 id="et-apr-s-">Et après ?</h3>
<p>Dans le <a href="/library/javafx-8-tutorial/fr/part4/">Tutorial Part 4</a> nous allons ajouter quelques styles CSS.</p>
<h5 id="voici-quelques-articles-qui-pourraient-aussi-vous-int-resser-">Voici quelques articles qui pourraient aussi vous intéresser :</h5>
<ul>
<li><a href="/blog/javafx-dialogs-official/">JavaFX Dialogs (official)</a></li>
<li><a href="/blog/javafx-8-date-picker/">JavaFX Date Picker</a></li>
<li><a href="/blog/javafx-8-event-handling-examples/">JavaFX Event Handling Examples</a></li>
<li><a href="/blog/javafx-8-tableview-sorting-filtering/">JavaFX TableView Sorting and Filtering</a></li>
<li><a href="/blog/javafx-8-tableview-cell-renderer/">JavaFX TableView Cell Renderer</a></li>
</ul>


          </div>
          
          <hr>
          
  <nav>
    <div class="article-paging">
      <ul class="pagination">
              <li>
      <a href="/library/javafx-8-tutorial/fr/" data-toggle="tooltip" title="Introduction">Intro</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part1/" data-toggle="tooltip" title="Partie 1 : le Scene Builder">1</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part2/" data-toggle="tooltip" title="Partie 2 : modèle et TableView">2</a>
      </li>
        <li class="active">
      <a href="/library/javafx-8-tutorial/fr/part3/" data-toggle="tooltip" title="Partie 3 : interaction avec l'utilisateur">3</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part4/" data-toggle="tooltip" title="Partie 4 : style CSS">4</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part5/" data-toggle="tooltip" title="Partie 5 : stockage de données en XML">5</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part6/" data-toggle="tooltip" title="Partie 6 : statistiques graphiques">6</a>
      </li>
        <li>
      <a href="/library/javafx-8-tutorial/fr/part7/" data-toggle="tooltip" title="Partie 7 : déploiement">7</a>
      </li>
    
      </ul>
    </div>
  </nav>

        </div>
      </article>
      
      
      <section class="row">
        <div class="col-md-offset-3 col-md-9">
          <h2>Comments</h2>
          <div id="disqus_thread"></div>
        </div>
      </section>
      
    </div>
        
    <footer class="site-footer container-fluid">
  <div class="row">
    <div class="col-sm-offset-2 col-sm-8">
      <p>
        <a class="btn btn-sm btn-social-icon btn-twitter" href="https://twitter.com/codemakery" data-toggle="tooltip" data-placement="top" title="Follow me on Twitter">
          <i class="fa fa-twitter"></i>
        </a>
        <a class="btn btn-sm btn-social-icon btn-googleplus" href="https://plus.google.com/+MarcoJakob7" data-toggle="tooltip" data-placement="top" title="Follow me on Google+">
          <i class="fa fa-google-plus"></i>
        </a>
        <a class="btn btn-sm btn-social-icon btn-rss" href="/rss" data-toggle="tooltip" data-placement="top" title="Subscribe to RSS Feed">
          <i class="fa fa-rss"></i>
        </a>
        <a class="btn btn-sm btn-social-icon btn-mail" href="https://tinyletter.com/codemakery" data-toggle="tooltip" data-placement="top" title="Receive Email Updates">
          <i class="fa fa-envelope" style="margin-top: -1px;"></i>
        </a>
      </p>
      <p>
        Subscribe to receive updates by <a href="https://tinyletter.com/codemakery">Email</a>.
      </p>
      
      <form class="form-inline" action="https://tinyletter.com/codemakery" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/codemakery', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <div class="form-group">
          <input type="text" class="form-control" name="email" id="tlemail" placeholder="Enter email" />
          <input type="hidden" value="1" name="embed"/>
          <input type="submit" class="form-control btn-primary" value="Get updates" />
        </div>
      </form>
      
      <p>
        <small>
          Created by <a href="/about">Marco Jakob</a> • Licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>
        </small>
      </p>
    </div>
  </div>
</footer>

    
    
    
  <script type="text/javascript" src="/theme/js/prettify.min.js"></script>

                                    
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'codemakery'; // Required - the forum shortname
    var disqus_identifier = '/library/javafx-8-tutorial/fr/part3/';
    var disqus_url = 'http://code.makery.ch/library/javafx-8-tutorial/fr/part3/';
    var disqus_title = 'Tutoriel JavaFX 8 - partie 3 : interaction avec lutilisateur';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

    

    
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script type="text/javascript" src="/theme/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="/theme/js/bootstrap-init-tooltips.min.js"></script>
    
  </body>
</html>